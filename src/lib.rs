use render::Renderer;
use wasm4::sys::{blit, BLIT_1BPP, BLIT_2BPP};
use wasm4::{draw::Framebuffer, rt::Resources};
use wasm4 as w4;
use math::Vector2;

pub mod game_world;
pub mod math;
pub mod player;
pub mod input_manager;
pub mod physics;
pub mod render;

pub struct MyRuntime {
    _framebuffer: Framebuffer
}

impl w4::rt::Runtime for MyRuntime {
    fn start(resources: Resources) -> Self {
        MyRuntime {
            _framebuffer: resources.framebuffer
        }
    }

    fn update(&mut self) {
        unsafe { *w4::sys::FRAMEBUFFER }.fill(0);
        let palette = unsafe { &mut *w4::sys::PALETTE };
        palette[0] = 0x0000aa;
        palette[1] = 0xfbf236;
        palette[2] = 0x222034;
        palette[3] = 0x696a6a;
        let draw_colors = unsafe { *w4::sys::DRAW_COLORS = 0x4321 }; 
        const SPRITE_0001: [u8; 256] = [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x2a,0xaa,0x80,0x00,0x00,0x00,0x00,0x02,0xaa,0xaa,0x80,0x00,0x00,0x00,0x00,0x01,0x55,0x56,0x80,0x00,0x00,0x00,0x00,0x04,0x00,0x01,0x80,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x10,0x80,0x20,0x10,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0xfc,0x00,0x00,0xf0,0x00,0x00,0x00,0x0f,0x03,0x00,0x0f,0x0f,0x00,0x00,0x00,0x0c,0x00,0xff,0xf0,0x00,0xc0,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x30,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x0c,0x00,0x00,0x00,0x00,0x0c,0x00,0x00,0x30,0x0c,0x00,0x00,0x00,0x0c,0x00,0x00,0x30,0x0c,0x00,0x00,0x30,0x0c,0x00,0x00,0xc0,0x33,0x00,0x00,0x30,0x0c,0x00,0x00,0xc0,0x33,0x00,0x00,0x30,0x0c,0x00,0x00,0x30,0xc3,0x00,0x00,0x30,0x30,0x00,0x00,0x0f,0x03,0x00,0x00,0x3f,0xc0,0x00,0x00,0x00,0x03,0xc0,0x00,0x30,0x00,0x00,0x00,0x00,0x0c,0x3f,0xf0,0x30,0x00,0x00,0x00,0x00,0x30,0x00,0x0f,0xf0,0x00,0x00,0x00,0x00,0xc0,0x3c,0x03,0xc0,0x00,0x00,0x00,0x00,0xc0,0xc3,0x00,0x30,0x00,0x00,0x00,0x03,0xc3,0x00,0xc0,0x0c,0x00,0x00,0x00,0x0c,0x03,0x00,0x30,0x0c,0x00,0x00,0x00,0x0f,0xfc,0x00,0x0f,0xfc,0x00,0x00];

        unsafe {
            blit(SPRITE_0001.as_ptr(), 80, 80, 15, 15, BLIT_2BPP);
        }
    }
}

w4::main! { MyRuntime }